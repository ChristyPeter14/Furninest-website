<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Details - FurniNest</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffe9c9;
        }

        /* Navbar Styling */
        .navbar {
            padding: 1rem;
            background-color: #d25620;
        }

        .navbar-brand {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .navbar-nav .nav-link {
            color: #ffffff;
            padding: 0.75rem 1rem;
        }

        .navbar-nav .nav-link:hover {
            background-color: #495057;
            border-radius: 0.25rem;
        }

        /* Breadcrumb */
        .breadcrumb-container {
            background-color: #e9ecef;
            padding: 1rem;
        }

        /* Main Container Styling */
        .main-container {
            display: flex;
            margin-top: 2rem;
        }

        /* Side Navigation */
        .side-nav {
            width: 250px;
            height: auto;
            padding: 1.5rem;
            background-color: #dab788;
            border-radius: 0.5rem;
        }

        .side-nav h5 {
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            color: #343a40;
        }

        .side-nav .btn {
            display: block;
            width: 100%;
            margin-bottom: 0.75rem;
            text-align: left;
            background-color: #ffffff;
            color: #000000;
            border: 1px solid #dee2e6;
            padding: 0.75rem;
            border-radius: 0.25rem;
        }

        .side-nav .btn:hover {
            background-color: #007bff;
            color: #ffffff;
        }

        /* Account Details Table */
        .account-details {
            width: 100%;
            padding: 2rem;
        }

        .account-details h2 {
            margin-bottom: 1.5rem;
        }

        .account-details table {
            width: 100%;
            margin-bottom: 2rem;
            border: 1px solid #dee2e6;
            background-color: #ffffff;
            border-radius: 0.25rem;
        }

        .account-details th, .account-details td {
            padding: 1rem;
            border: 1px solid #dee2e6;
        }

        .account-details th {
            background-color: #f8f9fa;
        }

        /* Footer */
        footer {
            background-color: #343a40;
            color: #ffffff;
            padding: 1rem;
            text-align: center;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .side-nav {
                width: 100%;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>

<body>

    <!-- Header (Navbar) -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">FurniNest</a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/shop">Shop</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/cart">Cart</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/userProfile">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/wishlist">Wishlist</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Wallet</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="breadcrumb-container">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Account Details</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container main-container">
        <!-- Side Navigation -->
        <div class="side-nav">
            <h5>Dashboard</h5>
            <button class="btn" ><a style="text-decoration: none;color: #000000;" href="/userAddress">Address</a></button>
        <a style="text-decoration: none;" href="/showOrder"><button class="btn">My Orders</button></a>
        <a style="text-decoration: none;" href="/userAccountDetails"> <button class="btn">Edit Account Details</button></a>
        <a style="text-decoration: none;" href="/wallet"> <button class="btn">Wallet</button></a>
        <a style="text-decoration: none;"  href="/logout"> <button class="btn">Logout</button></a>
        </div>

        <!-- Account Details Section -->
        <div class="account-details">
            <h2>Account Details</h2>

            <!-- Account Information Table -->
            <form method="post" action="/updateAccountDetails" name="enq"  onsubmit="return validateForm()">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>First Name</th>
                            <th>Email</th>
                            <th>Phone Number</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" class="form-control" name="name" value="<%=user.name%>" required></td>
                            <td><input type="email" class="form-control" name="nemail" value="<%=user.email%>" required></td>
                            <td><input type="text" class="form-control" name="mobile" value="<%=user.phone%>" required></td>
                            <td><button type="submit" name="submit" value="Submit" class="btn btn-primary">Update</button></td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <script>
                function validateForm() {
                    // Name validation (only alphabets)
                    const name = document.forms["enq"]["name"].value;
                    const nameRegex = /^[a-zA-Z\s]+$/;
                    if (!nameRegex.test(name)) {
                        alert("Please enter a valid name (letters only).");
                        return false;
                    }
        
                    // Email validation
                    const email = document.forms["enq"]["nemail"].value;
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        alert("Please enter a valid email address.");
                        return false;
                    }
        
                    // Phone number validation (only numbers, 10-15 digits)
                    const phone = document.forms["enq"]["mobile"].value;
                    const phoneRegex = /^[0-9]{10,15}$/;
                    if (!phoneRegex.test(phone)) {
                        alert("Please enter a valid phone number (10 to 15 digits).");
                        return false;
                    }
        
                    return true; // Submit the form if all validations pass
                }
            </script>
            <!-- Edit Password Table -->
            <h3>Edit Password</h3>
           <!-- Removed the action method to handle via fetch API -->
<!-- <form action="/changePassword" method="POST"> -->
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Current Password</th>
                <th>New Password</th>
                <th>Confirm New Password</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <input type="password" class="form-control" id="currentPassword" name="currentPassword" placeholder="Current Password" required>
                    <span id="showMessage1" class="text-danger"></span>
                </td>
                <td>
                    <input type="password" class="form-control" id="npassword" name="npassword" placeholder="New Password" required>
                    <span id="showMessage2" class="text-danger"></span>
                </td>
                <td>
                    <input type="password" class="form-control" id="cpassword" name="cpassword" placeholder="Confirm New Password" required>
                    <span id="showMessage3" class="text-danger"></span>
                </td>
                <td>
                    <button type="submit" class="btn btn-danger" id="changePasswordBtn">Change Password</button>
                </td>
            </tr>
        </tbody>
    </table>
<!-- </form> -->

<script>
    document.getElementById("changePasswordBtn").addEventListener("click", async function(event) {
        event.preventDefault(); // Prevent the default form submission

        // Get the input values
        const currentPassword = document.getElementById("currentPassword").value;
        const newPassword = document.getElementById("npassword").value;
        const confirmPassword = document.getElementById("cpassword").value;

        // Validate the form inputs
        if (!validatePasswords(currentPassword, newPassword, confirmPassword)) {
            return;  // Stop submission if validation fails
        }

        // Send the data to the server using Fetch API
        try {
            const response = await fetch("/updatePassword", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    currentPassword: currentPassword,
                    newPassword: newPassword,
                    confirmPassword: confirmPassword
                })
            });

            const result = await response.json();

            if (response.ok) {
                alert("Password changed successfully!");
                // Optionally, you can reset the form or redirect the user
            } else {
                alert(result.message || "Error changing password.");
            }
        } catch (error) {
            console.error("Error:", error);
            alert("An error occurred while changing password.");
        }
    });

    // Client-side validation function
    function validatePasswords(currentPassword, newPassword, confirmPassword) {
        let valid = true;

        // Validate current password
        if (!currentPassword) {
            document.getElementById("showMessage1").innerText = "Current password is required.";
            valid = false;
        } else {
            document.getElementById("showMessage1").innerText = "";
        }

        // Validate new password (at least 1 digit and 6 characters)
        const passwordRegex = /^(?=.*\d).{6,}$/;
        if (!passwordRegex.test(newPassword)) {
            document.getElementById("showMessage2").innerText = "New password must be at least 6 characters long and contain at least 1 digit.";
            valid = false;
        } else {
            document.getElementById("showMessage2").innerText = "";
        }

        // Validate confirm password
        if (newPassword !== confirmPassword) {
            document.getElementById("showMessage3").innerText = "Passwords do not match.";
            valid = false;
        } else {
            document.getElementById("showMessage3").innerText = "";
        }

        return valid;
    }
</script>

        </div>
    </div>

    <footer>
        &copy; 2024 FurniNest. All Rights Reserved.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
